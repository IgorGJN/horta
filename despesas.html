<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despesas</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #eef5ee;
}

header {
  background: #2e7d32;
  color: #fff;
  padding: 15px;
  text-align: center;
}

#total {
  background: #fff;
  margin: 12px 15px;
  padding: 12px;
  border-radius: 10px;
  font-weight: bold;
  text-align: center;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}

main {
  padding: 15px;
}

.card {
  background: #fff;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}

.card small {
  color: #555;
}

.botoes {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.botoes button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
}

.editar { background: #1976d2; color: #fff; }
.excluir { background: #c62828; color: #fff; }

.fab {
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: #2e7d32;
  color: #fff;
  font-size: 28px;
  border: none;
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display: none;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #fff;
  padding: 16px;
  width: 92%;
  max-width: 420px;
  border-radius: 12px;
}

.modal-content h3 {
  margin-top: 0;
  text-align: center;
}

.modal-content label {
  font-size: 14px;
  margin-top: 8px;
  display: block;
}

.modal-content input {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

.modal-botoes {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}

.modal-botoes button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 6px;
}
</style>
</head>

<body>

<header>
  <h2>ðŸ’° Controle de Despesas</h2>
</header>

<div id="total">Total: R$ 0,00</div>

<main id="lista"></main>

<button class="fab" onclick="abrir()">+</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Adicionar / Editar Despesa</h3>

    <label>DescriÃ§Ã£o *</label>
    <input id="descricao" placeholder="Ex: Compra de adubo">

    <label>Valor (R$) *</label>
    <input id="valor" type="number" step="0.01">

    <label>Data</label>
    <input id="data" type="date">

    <div class="modal-botoes">
      <button class="editar" onclick="salvarItem()">Salvar</button>
      <button class="excluir" onclick="fechar()">Cancelar</button>
    </div>
  </div>
</div>

<script>
let despesas = JSON.parse(localStorage.getItem("despesas")) || [];
let editando = null;

function hojeISO() {
  return new Date().toISOString().split("T")[0];
}

function salvarStorage() {
  localStorage.setItem("despesas", JSON.stringify(despesas));
}

function formatarValor(v) {
  return Number(v).toFixed(2).replace(".", ",");
}

function render() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  let total = 0;

  despesas.forEach((item, i) => {
    total += Number(item.valor) || 0;

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <strong>${item.descricao}</strong><br>
      <small>R$ ${formatarValor(item.valor)}</small><br>
      <small>ðŸ“… ${item.data}</small>
      <div class="botoes">
        <button class="editar" onclick="editar(${i})">Editar</button>
        <button class="excluir" onclick="excluir(${i})">Excluir</button>
      </div>
    `;
    lista.appendChild(div);
  });

  document.getElementById("total").innerText = `Total: R$ ${formatarValor(total)}`;
}

function abrir() {
  editando = null;
  descricao.value = "";
  valor.value = "";
  data.value = hojeISO();
  modal.style.display = "flex";
}

function fechar() {
  modal.style.display = "none";
}

function salvarItem() {
  if (!descricao.value.trim() || !valor.value.trim()) return;

  const item = {
    descricao: descricao.value,
    valor: Number(valor.value),
    data: data.value
  };

  if (editando === null) despesas.push(item);
  else despesas[editando] = item;

  salvarStorage();
  fechar();
  render();
}

function editar(i) {
  editando = i;
  const item = despesas[i];
  descricao.value = item.descricao;
  valor.value = item.valor;
  data.value = item.data;
  modal.style.display = "flex";
}

function excluir(i) {
  despesas.splice(i,1);
  salvarStorage();
  render();
}

render();
</script>

</body>
</html>