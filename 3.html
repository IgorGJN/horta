<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horta PET</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #eef5ee;
}

header {
  background: #2e7d32;
  color: #fff;
  padding: 15px;
  text-align: center;
}

main {
  padding: 15px;
}

.card {
  background: #fff;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}

.alerta {
  margin-top: 6px;
  padding: 6px;
  border-radius: 6px;
  font-size: 14px;
}

.rega { background: #e3f2fd; color: #1565c0; }
.adubo { background: #e8f5e9; color: #2e7d32; }
.colheita { background: #fff3e0; color: #ef6c00; }

.botoes {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.botoes button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
}

.editar { background: #1976d2; color: #fff; }
.excluir { background: #c62828; color: #fff; }
.concluir { background: #2e7d32; color: #fff; }

.fab {
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: #2e7d32;
  color: #fff;
  font-size: 28px;
  border: none;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display: none;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #fff;
  padding: 15px;
  width: 90%;
  border-radius: 10px;
}

.modal-content input {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
}
</style>
</head>

<body>

<header>
  <h2>ðŸŒ± Horta PET</h2>
  <small>SertÃ£o do CearÃ¡</small>
</header>

<main id="lista"></main>

<button class="fab" onclick="abrir()">+</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Adicionar / Editar</h3>
    <input id="nome" placeholder="Nome (obrigatÃ³rio)">
    <input id="rega" type="number" placeholder="Rega (dias)">
    <input id="adubo" type="number" placeholder="AdubaÃ§Ã£o (dias)">
    <input id="colheita" type="number" placeholder="Colheita (dias)">
    <input id="data" type="date">
    <button onclick="salvarItem()">Salvar</button>
    <button onclick="fechar()">Cancelar</button>
  </div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("horta")) || [];
let editando = null;

function hojeISO() {
  return new Date().toISOString().split("T")[0];
}

function diasPassados(data) {
  const inicio = new Date(data);
  const hoje = new Date();
  return Math.floor((hoje - inicio) / (1000*60*60*24));
}

function precisaHoje(dias, intervalo) {
  if (!intervalo || intervalo <= 0) return false;
  if (dias === 0) return false;
  return dias % intervalo === 0;
}

function salvarStorage() {
  localStorage.setItem("horta", JSON.stringify(dados));
}

function render() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  dados.forEach((item, i) => {
    const dias = diasPassados(item.data);

    const hojeRega = precisaHoje(dias, item.rega);
    const hojeAdubo = precisaHoje(dias, item.adubo);
    const hojeColheita = item.colheita && dias === item.colheita;

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <strong>${item.nome}</strong><br>
      <small>ðŸ“… ${dias} dias desde o plantio</small>

      ${hojeRega ? `<div class="alerta rega">ðŸ’§ REGAR HOJE</div>` : ""}
      ${hojeAdubo ? `<div class="alerta adubo">ðŸŒ¿ ADUBAR HOJE</div>` : ""}
      ${hojeColheita ? `<div class="alerta colheita">ðŸ¥¬ COLHER HOJE</div>` : ""}

      <div class="botoes">
        <button class="editar" onclick="editar(${i})">Editar</button>
        <button class="concluir" onclick="concluir(${i})">Concluir</button>
        <button class="excluir" onclick="excluir(${i})">Excluir</button>
      </div>
    `;

    lista.appendChild(div);
  });
}

function abrir() {
  editando = null;
  nome.value = "";
  rega.value = "";
  adubo.value = "";
  colheita.value = "";
  data.value = hojeISO();
  modal.style.display = "flex";
}

function fechar() {
  modal.style.display = "none";
}

function salvarItem() {
  if (!nome.value.trim()) return;

  const item = {
    nome: nome.value,
    rega: Number(rega.value) || null,
    adubo: Number(adubo.value) || null,
    colheita: Number(colheita.value) || null,
    data: data.value
  };

  if (editando === null) dados.push(item);
  else dados[editando] = item;

  salvarStorage();
  fechar();
  render();
}

function editar(i) {
  editando = i;
  const item = dados[i];
  nome.value = item.nome;
  rega.value = item.rega || "";
  adubo.value = item.adubo || "";
  colheita.value = item.colheita || "";
  data.value = item.data;
  modal.style.display = "flex";
}

function excluir(i) {
  dados.splice(i,1);
  salvarStorage();
  render();
}

function concluir(i) {
  dados.splice(i,1);
  salvarStorage();
  render();
}

render();
</script>

</body>
</html>