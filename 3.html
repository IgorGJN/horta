<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horta PET</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #eef5ee;
}
header {
  background: #2e7d32;
  color: #fff;
  padding: 15px;
  text-align: center;
}
main {
  padding: 15px;
}
.card {
  background: #fff;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}
.alerta {
  margin-top: 6px;
  padding: 6px;
  border-radius: 6px;
  font-size: 14px;
}
.rega { background: #e3f2fd; color: #1565c0; }
.adubo { background: #e8f5e9; color: #2e7d32; }
.colheita { background: #fff3e0; color: #ef6c00; }

.eventos {
  margin-top: 6px;
  font-size: 13px;
  color: #444;
}

.botoes {
  display: flex;
  gap: 6px;
  margin-top: 8px;
  flex-wrap: wrap;
}
.botoes button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 6px;
  font-size: 13px;
}

.editar { background: #1976d2; color: #fff; }
.excluir { background: #c62828; color: #fff; }
.concluir { background: #2e7d32; color: #fff; }
.evento { background: #eeeeee; }

.fab {
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: #2e7d32;
  color: #fff;
  font-size: 28px;
  border: none;
}

/* MODAL */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display: none;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  padding: 16px;
  width: 92%;
  max-width: 420px;
  border-radius: 12px;
}
.modal-content label {
  font-size: 14px;
  margin-top: 8px;
  display: block;
}
.modal-content input {
  width: 100%;
  padding: 10px;
  margin-top: 4px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
.modal-botoes {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}
.modal-botoes button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 6px;
}
</style>
</head>

<body>

<header>
  <h2>ðŸŒ± Horta PET</h2>
  <small>SertÃ£o do CearÃ¡</small>
</header>

<main id="lista"></main>

<button class="fab" onclick="abrir()">+</button>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Adicionar / Editar Planta</h3>

    <label>Nome *</label>
    <input id="nome">

    <label>Rega (dias)</label>
    <input id="rega" type="number">

    <label>AdubaÃ§Ã£o (dias)</label>
    <input id="adubo" type="number">

    <label>Colheita (dias)</label>
    <input id="colheita" type="number">

    <label>Data do plantio</label>
    <input id="data" type="date">

    <div class="modal-botoes">
      <button class="concluir" onclick="salvarItem()">Salvar</button>
      <button class="excluir" onclick="fechar()">Cancelar</button>
    </div>
  </div>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("horta")) || [];

// MIGRAÃ‡ÃƒO SEGURA
dados = dados.map(item => ({
  ...item,
  eventos: Array.isArray(item.eventos) ? item.eventos : []
}));

let editando = null;

function hojeISO() {
  return new Date().toISOString().split("T")[0];
}

function diasPassados(data) {
  return Math.floor((new Date() - new Date(data)) / 86400000);
}

function precisaHoje(dias, intervalo) {
  return intervalo && dias > 0 && dias % intervalo === 0;
}

function salvarStorage() {
  localStorage.setItem("horta", JSON.stringify(dados));
}

function adicionarEvento(i, tipo) {
  const dataEvento = prompt("Data do evento (AAAA-MM-DD):", hojeISO());
  if (!dataEvento) return;

  dados[i].eventos.push({ tipo, data: dataEvento });
  salvarStorage();
  render();
}

function render() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  dados.forEach((item, i) => {
    const dias = diasPassados(item.data);

    const eventosHTML = item.eventos.length
      ? `<div class="eventos">
          ${item.eventos.map(e => `ðŸ“Œ ${e.tipo} em ${e.data}`).join("<br>")}
        </div>`
      : "";

    lista.innerHTML += `
      <div class="card">
        <strong>${item.nome}</strong><br>
        <small>ðŸ“… ${dias} dias desde o plantio</small>

        ${precisaHoje(dias, item.rega) ? `<div class="alerta rega">ðŸ’§ REGAR HOJE</div>` : ""}
        ${precisaHoje(dias, item.adubo) ? `<div class="alerta adubo">ðŸŒ¿ ADUBAR HOJE</div>` : ""}
        ${item.colheita && dias === item.colheita ? `<div class="alerta colheita">ðŸ¥¬ COLHER HOJE</div>` : ""}

        ${eventosHTML}

        <div class="botoes">
          <button class="evento" onclick="adicionarEvento(${i}, 'germinacao')">ðŸŒ± Germinou</button>
          <button class="evento" onclick="adicionarEvento(${i}, 'adubacao')">ðŸŒ¿ Adubei</button>
          <button class="evento" onclick="adicionarEvento(${i}, 'colheita')">ðŸ¥¬ Colhi</button>
        </div>

        <div class="botoes">
          <button class="editar" onclick="editar(${i})">Editar</button>
          <button class="concluir" onclick="concluir(${i})">Concluir</button>
          <button class="excluir" onclick="excluir(${i})">Excluir</button>
        </div>
      </div>
    `;
  });
}

function abrir() {
  editando = null;
  nome.value = "";
  rega.value = "";
  adubo.value = "";
  colheita.value = "";
  data.value = hojeISO();
  modal.style.display = "flex";
}

function fechar() {
  modal.style.display = "none";
}

function salvarItem() {
  if (!nome.value.trim()) return;

  const item = {
    nome: nome.value,
    rega: Number(rega.value) || null,
    adubo: Number(adubo.value) || null,
    colheita: Number(colheita.value) || null,
    data: data.value,
    eventos: editando !== null ? dados[editando].eventos : []
  };

  if (editando === null) dados.push(item);
  else dados[editando] = item;

  salvarStorage();
  fechar();
  render();
}

function editar(i) {
  editando = i;
  const item = dados[i];
  nome.value = item.nome;
  rega.value = item.rega || "";
  adubo.value = item.adubo || "";
  colheita.value = item.colheita || "";
  data.value = item.data;
  modal.style.display = "flex";
}

function excluir(i) {
  if (!confirm("Excluir esta planta?")) return;
  dados.splice(i, 1);
  salvarStorage();
  render();
}

function concluir(i) {
  dados.splice(i, 1);
  salvarStorage();
  render();
}

render();
</script>

</body>
</html>